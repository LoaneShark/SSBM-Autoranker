<!--<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.1.1/css/responsive.bootstrap.min.css">-->
<div>
	<!-- nav tabs -->
	<ul class="nav nav-tabs d-flex nav-fill nav-justified" role="tablist" id=tables-tablist style="margin-left:0px">
		<li class="nav-item"><a id="current-tab" class="nav-link" href="#current-panel" aria-controls="current" role="tab" data-toggle="tab">Current</a></li>
		<li class="nav-item"><a id="past-tab" class="nav-link" href="#past-panel" aria-controls="past" role="tab" data-toggle="tab"></a></li>
		<li class="nav-item"><a id="alltime-tab" class="nav-link" href="#alltime-panel" aria-controls="alltime" role="tab" data-toggle="tab">All-Time</a></li>
	</ul>

	<!-- tab contents -->
	<div class="tab-content border border-top-0">
		<div role="tabpanel" class="tab-pane fade" id="current-panel" aria-labelledby="current-tab">
			<table id="current-table" class="table table-striped table-bordered hover" cellspacing="0" width="100%">
				<!-- table header -->
				<colgroup>
					<col width='15%' /> <!-- team     -->
					<col width='30%' /> <!-- player   -->
					<col width='10%' /> <!-- ssbmrank -->
					<col width='19%' /> <!-- s-rank   -->
					<col width='10%' /> <!-- elo      -->
					<col width='16%' /> <!-- glicko   -->
					<col width='16%' /> <!-- elo      -->
					<col width='16%' /> <!-- glicko   -->
				</colgroup>
				<thead>
					<tr class='header'>
						<th>Team</th>
						<th>Player</th>
						<th>{% if {{page.game}} == 'Ultimate'%}
								PGR
							{% elsif {{page.game}} == 'Melee' %}
								MPGR
							{% elsif {{page.game}} == 'PM' %}
								PMRank
							{% elsif {{page.game}} == 'Smash4' %}
								PGR
							{% elsif {{page.game}} == 'Brawl' %}
								SSBBRank
							{% elsif {{page.game}} == 64 %}
								64LR
							{% else %}
								Rank
							{% endif %}
						</th>
						<th>S-Rank
							<span class="fa-layers fa-fw">
								<i class="fas fa-square" data-fa-transform="shrink-3 up-3"></i>
								<span class="fa-layers-text fa-inverse" data-fa-transform="shrink-8 up-4 left-0.5" style="font-weight:400">
									&beta;
								</span>
							</span>
						</th>
						<th>ELO</th>
						<th>Glicko-2</th>
						<th>TrueSkill</th>
						<th>Glixare</th>
					</tr>
				</thead>
				<!-- table body -->
				<tbody>
					{% for i in (0..9) %}
						<tr>
							<td markdown='span' align='right' id={{'team_' | append: i}}></td>
							<td markdown='span' id={{'tag_' | append: i}}></td>
							<td markdown='span' id={{'rank_' | append: i}}></td>
							<td markdown='span' id={{'srank_' | append: i}}></td>
							<td markdown='span' id={{'elo_' | append: i}}></td>
							<td markdown='span' id={{'glicko_' | append: i}}></td>
							<td markdown='span' id={{'etrueskill_' | append: i}}></td>
							<td markdown='span' id={{'glixare_' | append: i}}></td>
						</tr>
					{% endfor %}
				</tbody>
			</table> <!-- current year -->
		</div> <!-- current year tab -->
		<div role="tabpanel" class="tab-pane fade" id="past-panel" aria-labelledby="past-tab">
			<table id="past-table" class="table table-striped table-bordered hover" cellspacing="0" width="100%">
				<!-- table header -->
				<colgroup>
					<col width='15%' /> <!-- team     -->
					<col width='30%' /> <!-- player   -->
					<col width='10%' /> <!-- ssbmrank -->
					<col width='19%' /> <!-- s-rank   -->
					<col width='10%' /> <!-- elo      -->
					<col width='16%' /> <!-- glicko   -->
				</colgroup>
				<thead>
					<tr class='header'>
						<th>Team</th>
						<th>Player</th>
						<th>{% if {{page.game}} == 'Ultimate'%}
								PGR
							{% elsif {{page.game}} == 'Melee' %}
								MPGR
							{% elsif {{page.game}} == 'PM' %}
								PMRank
							{% elsif {{page.game}} == 'Smash4' %}
								PGR
							{% elsif {{page.game}} == 'Brawl' %}
								SSBBRank
							{% elsif {{page.game}} == 64 %}
								64LR
							{% else %}
								Rank
							{% endif %}
						</th>
						<th>S-Rank
							<span class="fa-layers fa-fw">
								<i class="fas fa-square" data-fa-transform="shrink-3 up-3"></i>
								<span class="fa-layers-text fa-inverse" data-fa-transform="shrink-8 up-4 left-0.5" style="font-weight:400">
									&beta;
								</span>
							</span>
						</th>
						<th>ELO</th>
						<th>Glicko-2</th>
					</tr>
				</thead>
				<!-- table body -->
				<tbody>
					{% for i in (0..9) %}
						<tr>
							<td markdown='span' align='right' id={{'team_' | append: i}}></td>
							<td markdown='span' id={{'tag_' | append: i}}></td>
							<td markdown='span' id={{'rank_' | append: i}}></td>
							<td markdown='span' id={{'srank_' | append: i}}></td>
							<td markdown='span' id={{'elo_' | append: i}}></td>
							<td markdown='span' id={{'glicko_' | append: i}}></td>
						</tr>
					{% endfor %}
				</tbody>
			</table> <!-- past year -->
		</div> <!-- past year tab -->
		<div role="tabpanel" class="tab-pane fade" id="alltime-panel" aria-labelledby="alltime-tab">
			<table id="alltime-table" class="table table-striped table-bordered hover" cellspacing="0" width="100%">
				<!-- table header -->
				<colgroup>
					<col width='15%' /> <!-- team     -->
					<col width='30%' /> <!-- player   -->
					<col width='10%' /> <!-- ssbmrank -->
					<col width='19%' /> <!-- s-rank   -->
					<col width='10%' /> <!-- elo      -->
					<col width='16%' /> <!-- glicko   -->
				</colgroup>
				<thead>
					<tr class='header'>
						<th>Team</th>
						<th>Player</th>
						<th>{% if {{page.game}} == 'Ultimate'%}
								PGR
							{% elsif {{page.game}} == 'Melee' %}
								MPGR
							{% elsif {{page.game}} == 'PM' %}
								PMRank
							{% elsif {{page.game}} == 'Smash4' %}
								PGR
							{% elsif {{page.game}} == 'Brawl' %}
								SSBBRank
							{% elsif {{page.game}} == 64 %}
								64LR
							{% else %}
								Rank
							{% endif %}
						</th>
						<th>S-Rank
							<span class="fa-layers fa-fw">
								<i class="fas fa-square" data-fa-transform="shrink-3 up-3"></i>
								<span class="fa-layers-text fa-inverse" data-fa-transform="shrink-8 up-4 left-0.5" style="font-weight:400">
									&beta;
								</span>
							</span>
						</th>
						<th>ELO</th>
						<th>Glicko-2</th>
					</tr>
				</thead>
				<!-- table body -->
				<tbody>
					{% for i in (0..9) %}
						<tr>
							<td markdown='span' align='right' id={{'team_' | append: i}}></td>
							<td markdown='span' id={{'tag_' | append: i}}></td>
							<td markdown='span' id={{'rank_' | append: i}}></td>
							<td markdown='span' id={{'srank_' | append: i}}></td>
							<td markdown='span' id={{'elo_' | append: i}}></td>
							<td markdown='span' id={{'glicko_' | append: i}}></td>
						</tr>
					{% endfor %}
				</tbody>
			</table> <!-- past year -->
		</div> <!-- past year tab -->
	</div> <!-- tab content -->
</div> <!-- tables -->

<!-- DB import/connection -->
{% include firebase_scripts.html %}

<!-- jQuery, Bootstrap, DataTables, etc. imports -->
{% include datatables_scripts.html %}

<!-- populating page's table -->
<script type="text/javascript" src="/assets/js/table_utils.js"></script>
<!-- other functions -->
<script type="text/javascript" src="/assets/js/misc_utils.js"></script>
<script type="text/javascript" src="/assets/js/region_utils.js"></script>
<script>
	$().ready(function() {
		var game_id = getGameId("{{page.game}}");
		var gameTitle = "{{page.game}}"
		// get current year for db lookups
		var curr_year = new Date().getFullYear();
		// label the past year's tab
		$('#past-tab').html(curr_year-1)

		// populate "current" table
		var curr_ref_str = "/" + game_id + "_2016_" + (curr_year-2016)+ "_c" + "/p_info";
		//var curr_ref_str = "/" + game_id + "_" + (curr_year-1) + "_1/p_info";
		var curr_ref = firebase.database().ref(curr_ref_str);
		var curr_query = curr_ref.orderByChild('srank').limitToFirst(100)
		curr_query.once('value').then(function(PlayerSnapshot) {
			if (PlayerSnapshot.exists()) {
				var players = snapshotToTable(PlayerSnapshot);

				$('#current-table').DataTable( {
					data: players,
					responsive: true,
					ordering: true,
					paging: true,        
					//"autoWidth": false,
					//"order": [[3, "asc"],[5,"desc"]],
					"order": [[5,"desc"]],
					"dom": "<'row p-2'<'col-6'l><'col-6'f>><'row'<'col-12't>><'row p-2'<'col-6'i><'col-6'p>>",
					//"dom": '<"top"iflp<"clear">>rt<"bottom"iflp<"clear">>',
					//scrollY: 200,
					//scrollCollapse: true,
					columnDefs: [
								{targets: 0, className: 'text-right'},
								{targets: 1, data: null, render: function(dataCol){
									return '<a href="/games/'+gameTitle.toLowerCase()+'/players/#'+dataCol[8]+'">'+dataCol[1]+'</a>'
								}},
								//{targets: 2, type: 'num'}
								]
				});
				$('#current-tab').tab('show')
				$($.fn.dataTable.tables(true)).DataTable().columns.adjust().responsive.recalc();
			} else {
				console.log('whoops! db directory not found: '+ curr_ref_str);
				$('#current-tab').addClass("disabled");
				$('#past-tab').tab('show')
			}
		});
		// populate "past" table
		var past_ref_str = "/" + game_id + "_2016_" + (curr_year-2016)-1 + "_c/p_info";
		//var curr_ref_str = "/" + game_id + "_2016_" + (curr_year-2016)-1+ "_c" + "/p_info";
		var past_ref = firebase.database().ref(past_ref_str);
		var past_query = past_ref.orderByChild('srank').limitToFirst(100)
		past_query.once('value').then(function(PlayerSnapshot) {
			if (PlayerSnapshot.exists()) {
				var players = snapshotToTable(PlayerSnapshot);

				$('#past-table').DataTable( {
					data: players,
					responsive: true,
					ordering: true,
					paging: true,       
					//"autoWidth": false,
					//"order": [[3, "asc"],[5,"desc"]],
					"order": [[5,"desc"]],
					"dom": "<'row p-2'<'col-6'l><'col-6'f>><'row'<'col-12't>><'row p-2'<'col-6'i><'col-6'p>>",
					//"dom": '<"top"iflp<"clear">>rt<"bottom"iflp<"clear">>',
					//scrollY: 200,
					//scrollCollapse: true,
					columnDefs: [{targets: 0, className:'text-right'},
								{targets: 1, data: null, render: function(dataCol){
									return '<a href="/games/'+gameTitle.toLowerCase()+'/players/#'+dataCol[6]+'">'+dataCol[1]+'</a>'
								}},
								{targets: 2, type: 'num'}]
				});
				$($.fn.dataTable.tables(true)).DataTable().columns.adjust().responsive.recalc();
			} else {
				console.log('whoops! db directory not found: '+ past_ref_str);
				$('#past-tab').addClass("disabled");
			}
		});
		// populate "all-time" table
		var db_ref_str = "/" + game_id + "_2016_" + (curr_year-2016) + "/p_info";
		var db_ref = firebase.database().ref(db_ref_str);
		var db_query = db_ref.orderByChild('srank').limitToFirst(100);
		db_query.once('value').then(function(PlayerSnapshot) {
			if (PlayerSnapshot.exists()) {
				var players = snapshotToTable(PlayerSnapshot);

				$('#alltime-table').DataTable( {
					data: players,
					responsive: true,
					ordering: true,
					paging: true,
					//"autoWidth": false,
					//"order": [[3, "asc"],[5,"desc"]],
					"order": [[5,"desc"]],
					"dom": "<'row p-2'<'col-6'l><'col-6'f>><'row'<'col-12't>><'row p-2'<'col-6'i><'col-6'p>>",
					//"dom": '<"top"iflp<"clear">>rt<"bottom"iflp<"clear">>',
					//scrollY: 200,
					//scrollCollapse: true,
					columnDefs: [{targets: 0, className:'text-right'},
								{targets: 1, data: null, render: function(dataCol){
									return '<a href="/games/'+gameTitle.toLowerCase()+'/players/#'+dataCol[6]+'">'+dataCol[1]+'</a>'
								}},
								{targets: 2, type: 'num'}]
				});
				$($.fn.dataTable.tables(true)).DataTable().columns.adjust().responsive.recalc();
			} else {
				console.log('whoops! db directory not found: '+ db_ref_str);
				$('#alltime-tab').addClass("disabled");
			}
		});

		/*
		$(document).on('shown.bs.tab', 'a[data-toggle="tab"]', function (e) {
			$.fn.dataTable.tables({ visible: true, api: true }).columns.adjust();
			$('table.table').DataTable();
		});*/
		
		$('a[data-toggle="tab"]').on('shown.bs.tab', function(e) {
			////$.fn.dataTable.tables({visible: true, api: true}).columns.adjust().responsive.recalc();
			//$($.fn.dataTable.tables(true)).DataTable().columns.adjust().responsive.recalc();
			$($.fn.dataTable.tables(true)).css('width','100%');
			$($.fn.dataTable.tables(true)).DataTable().columns.adjust().responsive.recalc();
			//$('#past-tab').tab('show')
			
	        /*var currentTab = $(e.target).text(); // gets current tab
	        switch(currentTab) {
	        	case 'current':
	        		var table = $('#current-table').DataTable();
	        		$('#container').css('display','block');
	        		table.columns.adjust().draw();
	        		break;
	        	case 'past':
	        		var table = $('#past-table').DataTable();
	        		$('#container').css('display','block');
	        		table.columns.adjust().draw();
	        		break;
	        	case 'alltime':
	        		var table = $('#alltime-table').DataTable();
	        		$('#container').css('display','block');
	        		table.columns.adjust().draw();
	        		break;
	        	}*/
		});
	});
</script>
<!-- convert to interactive DataTable -->
<!--<script>
	$(document).ready(function() {
		//$('a[data-toggle="tab"]').on('shown.bs.tab', function(e) {
		//	$.fn.dataTable.tables({visible: true, api: true}).columns.adjust();
		//});

		$('#top10').DataTable( {
			//scrollY: 200,
			//scrollCollapse: true,
        	"order": [[ 3, "desc" ]],
        	"dom": '<"top"iflp<"clear">>rt<"bottom"iflp<"clear">>',
			paging: false
		});

		//$('#top50').DataTable( {
		//	paging: false
		//});
	});

</script>-->
<script>
	// fill the empty table with db values
	window.onload = function() {
		$.fn.dataTable.tables({visible: true, api: true}).columns.adjust();
		//document.getElementById('team').innerHTML='big';
		//document.getElementById('tag').innerHTML='chungus';
		//document.getElementById('rank').innerHTML='is';
		//document.getElementById('srank').innerHTML='very';
		//document.getElementById('elo').innerHTML='VERY';
		//document.getElementById('glicko').innerHTML='sexxy';
	}
</script>


  <!--{% for item in site.data.navigation %}
    <a href="{{ item.link }}" {% if page.url == item.link %}class="current"{% endif %}>{{ item.name }}</a>
  {% endfor %}-->