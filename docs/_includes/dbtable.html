<!-- Bootstrap, DataTables CSS -->
{% include bootstrap_css.html %}
<!--<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.1.1/css/responsive.bootstrap.min.css">-->
<div>
	<!-- nav tabs -->
	<ul class="nav nav-tabs nav-justified center-block" role="tablist">
		<li role="presentation" class="active"><a id="current-tab" class="nav-link active" href="#current" aria-controls="current" role="tab" data-toggle="tab">Current</a></li>
		<li role="presentation"><a id="past-tab" class="nav-link" href="#past" aria-controls="past" role="tab" data-toggle="tab"></a></li>
		<li role="presentation"><a id="alltime-tab" class="nav-link" href="#alltime" aria-controls="alltime" role="tab" data-toggle="tab">All-Time</a></li>
	</ul>

	<!-- tab contents -->
	<div class="tab-content">
		<div role="tabpanel" class="tab-pane fade in active" id="current-panel">
			<table id="current-table" class="table table-striped table-bordered hover" cellspacing="0" width="100%">
				<!-- table header -->
				<colgroup>
					<col width='15%' /> <!-- team     -->
					<col width='30%' /> <!-- player   -->
					<col width='10%' /> <!-- ssbmrank -->
					<col width='10%' /> <!-- s-rank   -->
					<col width='10%' /> <!-- elo      -->
					<col width='10%' /> <!-- glicko   -->
				</colgroup>
				<thead>
					<tr class='header'>
						<th>Team</th>
						<th>Player</th>
						<th>{% if {{page.title}} == 'Ultimate'%}
								PGR
							{% elsif {{page.title}} == 'Melee' %}
								MPGR
							{% elsif {{page.title}} == 'PM' %}
								PMRank
							{% elsif {{page.title}} == 'Smash4' %}
								PGR
							{% else %}
								Rank
							{% endif %}
						</th>
						<th>S-Rank</th>
						<th>ELO</th>
						<th>Glicko-2</th>
					</tr>
				</thead>
				<!-- table body -->
				<tbody>
					{% for i in (0..9) %}
						<tr>
							<td markdown='span' align='right' id={{'team_' | append: i}}></td>
							<td markdown='span' id={{'tag_' | append: i}}></td>
							<td markdown='span' id={{'rank_' | append: i}}></td>
							<td markdown='span' id={{'srank_' | append: i}}></td>
							<td markdown='span' id={{'elo_' | append: i}}></td>
							<td markdown='span' id={{'glicko_' | append: i}}></td>
						</tr>
					{% endfor %}
				</tbody>
			</table> <!-- current year -->
		</div> <!-- current year tab -->
		<div role="tabpanel" class="tab-pane fade" id="past-panel">
			<table id="past-table" class="table table-striped table-bordered hover" cellspacing="0" width="100%">
				<!-- table header -->
				<colgroup>
					<col width='15%' /> <!-- team     -->
					<col width='30%' /> <!-- player   -->
					<col width='10%' /> <!-- ssbmrank -->
					<col width='10%' /> <!-- s-rank   -->
					<col width='10%' /> <!-- elo      -->
					<col width='10%' /> <!-- glicko   -->
				</colgroup>
				<thead>
					<tr class='header'>
						<th>Team</th>
						<th>Player</th>
						<th>{% if {{page.title}} == 'Ultimate'%}
								PGR
							{% elsif {{page.title}} == 'Melee' %}
								MPGR
							{% elsif {{page.title}} == 'PM' %}
								PMRank
							{% elsif {{page.title}} == 'Smash4' %}
								PGR
							{% else %}
								Rank
							{% endif %}
						</th>
						<th>S-Rank</th>
						<th>ELO</th>
						<th>Glicko-2</th>
					</tr>
				</thead>
				<!-- table body -->
				<tbody>
					{% for i in (0..9) %}
						<tr>
							<td markdown='span' align='right' id={{'team_' | append: i}}></td>
							<td markdown='span' id={{'tag_' | append: i}}></td>
							<td markdown='span' id={{'rank_' | append: i}}></td>
							<td markdown='span' id={{'srank_' | append: i}}></td>
							<td markdown='span' id={{'elo_' | append: i}}></td>
							<td markdown='span' id={{'glicko_' | append: i}}></td>
						</tr>
					{% endfor %}
				</tbody>
			</table> <!-- past year -->
		</div> <!-- past year tab -->
		<div role="tabpanel" class="tab-pane fade" id="alltime-panel">
			<table id="alltime-table" class="table table-striped table-bordered hover" cellspacing="0" width="100%">
				<!-- table header -->
				<colgroup>
					<col width='15%' /> <!-- team     -->
					<col width='30%' /> <!-- player   -->
					<col width='10%' /> <!-- ssbmrank -->
					<col width='10%' /> <!-- s-rank   -->
					<col width='10%' /> <!-- elo      -->
					<col width='10%' /> <!-- glicko   -->
				</colgroup>
				<thead>
					<tr class='header'>
						<th>Team</th>
						<th>Player</th>
						<th>{% if {{page.title}} == 'Ultimate'%}
								PGR
							{% elsif {{page.title}} == 'Melee' %}
								MPGR
							{% elsif {{page.title}} == 'PM' %}
								PMRank
							{% elsif {{page.title}} == 'Smash4' %}
								PGR
							{% else %}
								Rank
							{% endif %}
						</th>
						<th>S-Rank</th>
						<th>ELO</th>
						<th>Glicko-2</th>
					</tr>
				</thead>
				<!-- table body -->
				<tbody>
					{% for i in (0..9) %}
						<tr>
							<td markdown='span' align='right' id={{'team_' | append: i}}></td>
							<td markdown='span' id={{'tag_' | append: i}}></td>
							<td markdown='span' id={{'rank_' | append: i}}></td>
							<td markdown='span' id={{'srank_' | append: i}}></td>
							<td markdown='span' id={{'elo_' | append: i}}></td>
							<td markdown='span' id={{'glicko_' | append: i}}></td>
						</tr>
					{% endfor %}
				</tbody>
			</table> <!-- past year -->
		</div> <!-- past year tab -->
	</div> <!-- tab content -->
</div> <!-- tables -->

<!-- DB import/connection -->
{% include firebase_scripts.html %}

<!-- jQuery, Bootstrap, DataTables imports -->
{% include bootstrap_scripts.html %}
{% include datatables_scripts.html %}

<!-- populating page's table -->
<script src="/assets/js/table_utils.js"></script>
<!-- other functions -->
<script src="/assets/js/misc_utils.js"></script>
<script>
	$().ready(function() {
		//var page_title = "{{page.title}}"
		//var title_ids = {"Melee":1,"PM":2,"Smash4":3,"64":4,"Brawl":5,"Ultimate":1386}
		//var game_id = title_ids[page_title]
		var game_id = getGameId("{{page.title}}")
		// get current year for db lookups
		var curr_year = new Date().getFullYear();
		// label the past year's tab
		$('#past-tab').html(curr_year-1)

		// populate "current" table
		var curr_ref_str = "/" + game_id + "_" + (curr_year-1) + "_1/p_info";
		var curr_ref = firebase.database().ref(curr_ref_str);
		var curr_query = curr_ref.orderByChild('srank').limitToFirst(10)
		curr_query.once('value').then(function(PlayerSnapshot) {
			if (PlayerSnapshot.exists()) {
				var players = snapshotToTable(PlayerSnapshot);

				$('#current-table').DataTable( {
					data: players,
					ordering: true,
					paging: false,        	
					"order": [[ 3, "asc" ]],
					"dom": '<"top"iflp<"clear">>rt<"bottom"iflp<"clear">>',
					//scrollY: 200,
					//scrollCollapse: true,
					columnDefs: [{targets: 0, className:'dt-body-right'}]
				});
			} else {
				console.log('whoops! db directory not found: '+ curr_ref_str)
				$('#current-tab').addClass("disabled")
			};
		});
		// populate "past" table
		var past_ref_str = "/" + game_id + "_" + (curr_year-1) + "_0/p_info";
		var past_ref = firebase.database().ref(past_ref_str);
		var past_query = past_ref.orderByChild('srank').limitToFirst(10)
		past_query.once('value').then(function(PlayerSnapshot) {
			if (PlayerSnapshot.exists()) {
				var players = snapshotToTable(PlayerSnapshot);

				$('#past-table').DataTable( {
					data: players,
					ordering: true,
					paging: false,        	
					"order": [[ 3, "asc" ]],
					"dom": '<"top"iflp<"clear">>rt<"bottom"iflp<"clear">>',
					//scrollY: 200,
					//scrollCollapse: true,
					columnDefs: [{targets: 0, className:'dt-body-right'}]
				});
			} else {
				console.log('whoops! db directory not found: '+ past_ref_str)
				$('#past-tab').addClass("disabled")
			};
		});
		// populate "all-time" table
		var db_ref_str = "/" + game_id + "_2016_" + (curr_year-2016) + "/p_info";
		var db_ref = firebase.database().ref(db_ref_str);
		var db_query = db_ref.orderByChild('srank').limitToFirst(10)
		db_query.once('value').then(function(PlayerSnapshot) {
			if (PlayerSnapshot.exists()) {
				var players = snapshotToTable(PlayerSnapshot);

				$('#alltime-table').DataTable( {
					data: players,
					ordering: true,
					paging: false,        	
					"order": [[ 3, "asc" ]],
					"dom": '<"top"iflp<"clear">>rt<"bottom"iflp<"clear">>',
					//scrollY: 200,
					//scrollCollapse: true,
					columnDefs: [{targets: 0, className:'dt-body-right'}]
				});
			} else {
				console.log('whoops! db directory not found: '+ db_ref_str)
				$('#alltime-tab').addClass("disabled")
			};
		});

		$('a[data-toggle="tab"]').on('shown.bs.tab', function(e) {
			$.fn.dataTable.tables({visible: true, api: true}).columns.adjust();
	        var currentTab = $(e.target).text(); // gets current tab
	        switch(currentTab) {
	        	case 'current':
	        		var table = $('#current-table').DataTable();
	        		$('#container').css('display','block');
	        		table.columns.adjust().draw();
	        		break;
	        	case 'past':
	        		var table = $('#past-table').DataTable();
	        		$('#container').css('display','block');
	        		table.columns.adjust().draw();
	        		break;
	        	case 'alltime':
	        		var table = $('#alltime-table').DataTable();
	        		$('#container').css('display','block');
	        		table.columns.adjust().draw();
	        		break;
	        	};
		});
	});
</script>
<!-- convert to interactive DataTable -->
<!--<script>
	$(document).ready(function() {
		//$('a[data-toggle="tab"]').on('shown.bs.tab', function(e) {
		//	$.fn.dataTable.tables({visible: true, api: true}).columns.adjust();
		//});

		$('#top10').DataTable( {
			//scrollY: 200,
			//scrollCollapse: true,
        	"order": [[ 3, "desc" ]],
        	"dom": '<"top"iflp<"clear">>rt<"bottom"iflp<"clear">>',
			paging: false
		});

		//$('#top50').DataTable( {
		//	paging: false
		//});
	});

</script>-->
<script>
	// fill the empty table with db values
	window.onload = function() {
		//document.getElementById('team').innerHTML='big';
		//document.getElementById('tag').innerHTML='chungus';
		//document.getElementById('rank').innerHTML='is';
		//document.getElementById('srank').innerHTML='very';
		//document.getElementById('elo').innerHTML='VERY';
		//document.getElementById('glicko').innerHTML='sexxy';
	};
</script>


  <!--{% for item in site.data.navigation %}
    <a href="{{ item.link }}" {% if page.url == item.link %}class="current"{% endif %}>{{ item.name }}</a>
  {% endfor %}-->